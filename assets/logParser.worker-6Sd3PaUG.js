(function(){"use strict";class y{static getLines(s){return s?Array.isArray(s)?s:s.split(`
`):[]}static extractByKeyword(s,c){const e=[],r=this.getLines(s);if(r.length===0)return e;const a=/[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/,o=c.toLowerCase();return r.forEach((i,n)=>{const t=i.toLowerCase().indexOf(o);if(t!==-1){const f=i.substring(t+c.length).match(a);if(f){const d=parseFloat(f[0]);isNaN(d)||e.push({value:d,line:n+1,text:i.trim(),format:"Keyword Match"})}}}),e}static extractByColumn(s,c,e=" "){const r=[],a=this.getLines(s);return a.length===0||a.forEach((o,i)=>{if(o.trim()){const n=e===" "?o.trim().split(/\s+/):o.split(e);if(n.length>c){const t=parseFloat(n[c]);isNaN(t)||r.push({value:t,line:i+1,text:o.trim()})}}}),r}static extractBySmart(s,c="loss"){const e=[],r=this.getLines(s);if(r.length===0)return e;const a=c==="loss"?["loss","training_loss","train_loss","val_loss","validation_loss"]:["grad_norm","gradient_norm","gnorm","grad norm","gradient norm","global_norm"];return r.forEach((o,i)=>{try{const n=o.match(/\{.*\}/);if(n){const t=JSON.parse(n[0]);for(const l of a)if(t[l]!==void 0){const f=parseFloat(t[l]);if(!isNaN(f)){e.push({value:f,line:i+1,text:o.trim(),format:"JSON"});return}}}}catch{}for(const n of a){const t=[new RegExp(`${n}\\s*[:=]\\s*([\\d.eE+-]+)`,"i"),new RegExp(`"${n}"\\s*:\\s*([\\d.eE+-]+)`,"i"),new RegExp(`${n}\\s+([\\d.eE+-]+)`,"i"),new RegExp(`${n}\\s*:\\s*\\[([\\d.eE+-]+)\\]`,"i"),new RegExp(`${n}\\s*:\\s*\\[\\s*([\\d.eE+-]+)\\s*\\]`,"i")];for(const l of t){const f=o.match(l);if(f){const d=parseFloat(f[1]);if(!isNaN(d)){e.push({value:d,line:i+1,text:o.trim(),format:n.includes("global_norm")?"MindFormers":"Key-Value"});return}}}}}),e}static extractByRegex(s,c){const e=[],r=this.getLines(s);if(r.length===0)return e;try{const a=new RegExp(c,"gi");r.forEach((o,i)=>{[...o.matchAll(a)].forEach(t=>{if(t[1]){const l=parseFloat(t[1]);isNaN(l)||e.push({value:l,line:i+1,text:o.trim()})}})})}catch{}return e}}const m=(u,s)=>{if(!s.enabled)return null;const c=u.toLowerCase().indexOf(s.keyword.toLowerCase());if(c!==-1){const r=u.substring(c+s.keyword.length).match(/[+-]?\d+/);if(r){const a=parseInt(r[0],10);if(!isNaN(a))return a}}return null};self.onmessage=u=>{const{type:s,payload:c}=u.data;if(s==="PARSE_FILE"){const{fileId:e,content:r,config:a}=c,o={};try{const i=r.split(`
`),n={enabled:a.useStepKeyword,keyword:a.stepKeyword||"step:"};a.metrics.forEach((t,l)=>{let f=[],d=[];t.mode==="keyword"?d=y.extractByKeyword(i,t.keyword):t.regex&&(d=y.extractByRegex(i,t.regex)),f=d.map((p,w)=>{const h=m(p.text,n);return{x:h!==null?h:w,y:p.value}});let g="";t.name&&t.name.trim()?g=t.name.trim():t.keyword?g=t.keyword.replace(/[:ï¼š]/g,"").trim():t.regex?g=t.regex.replace(/[^a-zA-Z0-9_]/g,"").trim()||`metric${l+1}`:g=`metric${l+1}`,o[g]=f}),self.postMessage({type:"PARSE_COMPLETE",payload:{fileId:e,metricsData:o}})}catch(i){self.postMessage({type:"PARSE_ERROR",payload:{fileId:e,error:i.message}})}}}})();
