(function(){"use strict";class g{static extractByKeyword(o,n){const e=[];if(!o)return e;const a=o.split(`
`),i=/[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/;return a.forEach((s,l)=>{const r=s.toLowerCase().indexOf(n.toLowerCase());if(r!==-1){const c=s.substring(r+n.length).match(i);if(c){const f=parseFloat(c[0]);isNaN(f)||e.push({value:f,line:l+1,text:s.trim(),format:"Keyword Match"})}}}),e}static extractByColumn(o,n,e=" "){const a=[];return o&&o.split(`
`).forEach((s,l)=>{if(s.trim()){const r=e===" "?s.trim().split(/\s+/):s.split(e);if(r.length>n){const t=parseFloat(r[n]);isNaN(t)||a.push({value:t,line:l+1,text:s.trim()})}}}),a}static extractBySmart(o,n="loss"){const e=[];if(!o)return e;const a=o.split(`
`),i=n==="loss"?["loss","training_loss","train_loss","val_loss","validation_loss"]:["grad_norm","gradient_norm","gnorm","grad norm","gradient norm","global_norm"];return a.forEach((s,l)=>{try{const r=s.match(/\{.*\}/);if(r){const t=JSON.parse(r[0]);for(const c of i)if(t[c]!==void 0){const f=parseFloat(t[c]);if(!isNaN(f)){e.push({value:f,line:l+1,text:s.trim(),format:"JSON"});return}}}}catch{}for(const r of i){const t=[new RegExp(`${r}\\s*[:=]\\s*([\\d.eE+-]+)`,"i"),new RegExp(`"${r}"\\s*:\\s*([\\d.eE+-]+)`,"i"),new RegExp(`${r}\\s+([\\d.eE+-]+)`,"i"),new RegExp(`${r}\\s*:\\s*\\[([\\d.eE+-]+)\\]`,"i"),new RegExp(`${r}\\s*:\\s*\\[\\s*([\\d.eE+-]+)\\s*\\]`,"i")];for(const c of t){const f=s.match(c);if(f){const d=parseFloat(f[1]);if(!isNaN(d)){e.push({value:d,line:l+1,text:s.trim(),format:r.includes("global_norm")?"MindFormers":"Key-Value"});return}}}}}),e}static extractByRegex(o,n){const e=[];if(!o)return e;const a=o.split(`
`);try{const i=new RegExp(n,"gi");a.forEach((s,l)=>{[...s.matchAll(i)].forEach(t=>{if(t[1]){const c=parseFloat(t[1]);isNaN(c)||e.push({value:c,line:l+1,text:s.trim()})}})})}catch{}return e}}const x=(u,o)=>{if(!o.enabled)return null;const n=u.toLowerCase().indexOf(o.keyword.toLowerCase());if(n!==-1){const a=u.substring(n+o.keyword.length).match(/[+-]?\d+/);if(a){const i=parseInt(a[0],10);if(!isNaN(i))return i}}return null};self.onmessage=u=>{const{type:o,payload:n}=u.data;if(o==="PARSE_FILE"){const{fileId:e,content:a,config:i}=n,s={};try{const l=a.split(`
`),r={enabled:i.useStepKeyword,keyword:i.stepKeyword||"step:"};i.metrics.forEach((t,c)=>{let f=[],d=[];t.mode==="keyword"?d=g.extractByKeyword(a,t.keyword):t.regex&&(d=g.extractByRegex(a,t.regex)),f=d.map((y,h)=>{const m=x(y.text,r);return{x:m!==null?m:h,y:y.value}});let p="";t.name&&t.name.trim()?p=t.name.trim():t.keyword?p=t.keyword.replace(/[:ï¼š]/g,"").trim():t.regex?p=t.regex.replace(/[^a-zA-Z0-9_]/g,"").trim()||`metric${c+1}`:p=`metric${c+1}`,s[p]=f}),self.postMessage({type:"PARSE_COMPLETE",payload:{fileId:e,metricsData:s}})}catch(l){self.postMessage({type:"PARSE_ERROR",payload:{fileId:e,error:l.message}})}}}})();
